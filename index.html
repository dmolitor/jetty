<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Execute R in a Docker Context • jetty</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Execute R in a Docker Context">
<meta name="description" content="The goal of jetty is to execute R functions and code snippets in an isolated R subprocess within a Docker container and return the evaluated results to the local R session. jetty can install necessary packages at runtime and seamlessly propagates errors and outputs from the Docker subprocess back to the main session. jetty is primarily designed for sandboxed testing and quick execution of example code.">
<meta property="og:description" content="The goal of jetty is to execute R functions and code snippets in an isolated R subprocess within a Docker container and return the evaluated results to the local R session. jetty can install necessary packages at runtime and seamlessly propagates errors and outputs from the Docker subprocess back to the main session. jetty is primarily designed for sandboxed testing and quick execution of example code.">
<meta property="og:image" content="https://dmolitor.com/jetty/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">jetty</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dmolitor/jetty/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="jetty-">jetty <a class="anchor" aria-label="anchor" href="#jetty-"></a>
</h1>
</div>
<!-- badges: start -->

<blockquote>
<p>Execute R functions or code blocks within a Docker container.</p>
</blockquote>
<p>It may be useful, in certain circumstances, to perform a computation in a separate R process that is running within a Docker container. This package attempts to achieve this!</p>
<div class="section level2">
<h2 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h2>
<ul>
<li><p>Calls an R function with arguments or a code block in a subprocess within a Docker container.</p></li>
<li><p>Copies function arguments (as necessary) to the subprocess and copies the return value of the function/code block.</p></li>
<li><p>Discovers and installs required packages in the Docker container at run-time.</p></li>
<li><p>Copies error objects back from the subprocess. In general, these error objects do not include the stack trace from the Docker R process. However, if for example the error is an rlang error, it will include the full stack trace.</p></li>
<li><p>Shows and/or collects the standard output and standard error of the Docker subprocess.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install jetty from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"jetty"</span><span class="op">)</span></span></code></pre></div>
<p>Or install the development version of jetty from GitHub:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pkg_install.html" class="external-link">pkg_install</a></span><span class="op">(</span><span class="st">"dmolitor/jetty"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="synchronous-one-off-r-processes-in-a-docker-container">Synchronous, one-off R processes in a Docker container<a class="anchor" aria-label="anchor" href="#synchronous-one-off-r-processes-in-a-docker-container"></a>
</h2>
<p>Use <code><a href="reference/run.html">run()</a></code> to execute an R function or code block in a new R process within a Docker container. The results are passed back directly to the local R session.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">jetty</span><span class="fu">::</span><span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;              Sepal.Length Sepal.Width Petal.Length Petal.Width</span></span>
<span><span class="co">#&gt; Sepal.Length    0.6856935  -0.0424340    1.2743154   0.5162707</span></span>
<span><span class="co">#&gt; Sepal.Width    -0.0424340   0.1899794   -0.3296564  -0.1216394</span></span>
<span><span class="co">#&gt; Petal.Length    1.2743154  -0.3296564    3.1162779   1.2956094</span></span>
<span><span class="co">#&gt; Petal.Width     0.5162707  -0.1216394    1.2956094   0.5810063</span></span></code></pre></div>
<div class="section level3">
<h3 id="specifying-docker-container">Specifying Docker container<a class="anchor" aria-label="anchor" href="#specifying-docker-container"></a>
</h3>
<p>The desired Docker container can be set via the <code>image</code> argument, and should be specified as a string in standard Docker format. These formats include <code>username/image:tag</code>, <code>username/image</code>, <code>image:tag</code>, and <code>image</code>. The default choice is <code>r-base:{jetty:::r_version()}</code> which is a bare-bones R image that mirrors the R version running locally. For example, the following command would be executed in the official <a href="https://hub.docker.com/_/r-base" class="external-link"><code>r-base</code></a> image with the latest version of R, which comes with no packages beyond the base set installed:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">jetty</span><span class="fu">::</span><span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>, image <span class="op">=</span> <span class="st">"r-base:latest"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="passing-arguments">Passing arguments<a class="anchor" aria-label="anchor" href="#passing-arguments"></a>
</h3>
<p>You can pass arguments to the function by setting <code>args</code> to the list of arguments, similar to the base <code>do.call</code> function. This is often necessary, as the function being evaluated in the Docker R process does not have access to variables in the parent process. For example, the following does not work:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mycars</span> <span class="op">&lt;-</span> <span class="va">cars</span></span>
<span><span class="fu">jetty</span><span class="fu">::</span><span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mycars</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in (function () : object 'mycars' not found</span></span></code></pre></div>
<p>But this does:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mycars</span> <span class="op">&lt;-</span> <span class="va">cars</span></span>
<span><span class="fu">jetty</span><span class="fu">::</span><span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">mycars</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      speed           dist       </span></span>
<span><span class="co">#&gt;  Min.   : 4.0   Min.   :  2.00  </span></span>
<span><span class="co">#&gt;  1st Qu.:12.0   1st Qu.: 26.00  </span></span>
<span><span class="co">#&gt;  Median :15.0   Median : 36.00  </span></span>
<span><span class="co">#&gt;  Mean   :15.4   Mean   : 42.98  </span></span>
<span><span class="co">#&gt;  3rd Qu.:19.0   3rd Qu.: 56.00  </span></span>
<span><span class="co">#&gt;  Max.   :25.0   Max.   :120.00</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-packages">Using packages<a class="anchor" aria-label="anchor" href="#using-packages"></a>
</h3>
<p>You can use any package in the child R process, with the caveat that the package must be installed in the Docker container. While it’s recommended to refer to it explicitly with the <code>::</code> operator, the code snippet can also call <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> or <code><a href="https://rdrr.io/r/base/library.html" class="external-link">require()</a></code> and will work fine. For example, the following code snippets both work equally well:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">jetty</span><span class="fu">::</span><span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org" class="external-link">Matrix</a></span><span class="op">)</span>;</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">nrow</span>, <span class="va">ncol</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/rsparsematrix.html" class="external-link">rsparsematrix</a></span><span class="op">(</span><span class="va">nrow</span>, <span class="va">ncol</span>, density <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">10</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Matrix</span></span>
<span><span class="co">#&gt; 10 x 2 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">#&gt;                   </span></span>
<span><span class="co">#&gt;  [1,] -0.55 -0.230</span></span>
<span><span class="co">#&gt;  [2,] -1.20  0.170</span></span>
<span><span class="co">#&gt;  [3,]  1.70  1.100</span></span>
<span><span class="co">#&gt;  [4,]  0.89  0.660</span></span>
<span><span class="co">#&gt;  [5,] -0.42  0.860</span></span>
<span><span class="co">#&gt;  [6,]  0.75  0.340</span></span>
<span><span class="co">#&gt;  [7,] -0.28  1.100</span></span>
<span><span class="co">#&gt;  [8,]  0.69 -1.000</span></span>
<span><span class="co">#&gt;  [9,] -1.10  0.043</span></span>
<span><span class="co">#&gt; [10,] -2.30 -0.220</span></span></code></pre></div>
<p>and</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">jetty</span><span class="fu">::</span><span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">nrow</span>, <span class="va">ncol</span><span class="op">)</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/rsparsematrix.html" class="external-link">rsparsematrix</a></span><span class="op">(</span><span class="va">nrow</span>, <span class="va">ncol</span>, density <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">10</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; 10 x 2 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">#&gt;                   </span></span>
<span><span class="co">#&gt;  [1,]  0.027 -1.90</span></span>
<span><span class="co">#&gt;  [2,]  0.300  0.26</span></span>
<span><span class="co">#&gt;  [3,]  0.022  0.37</span></span>
<span><span class="co">#&gt;  [4,] -1.100  1.30</span></span>
<span><span class="co">#&gt;  [5,]  1.900 -0.88</span></span>
<span><span class="co">#&gt;  [6,] -0.140 -0.43</span></span>
<span><span class="co">#&gt;  [7,] -0.980 -1.50</span></span>
<span><span class="co">#&gt;  [8,]  0.350  0.72</span></span>
<span><span class="co">#&gt;  [9,] -0.350  0.69</span></span>
<span><span class="co">#&gt; [10,]  0.870  1.00</span></span></code></pre></div>
<div class="section level4">
<h4 id="installing-required-packages">Installing required packages<a class="anchor" aria-label="anchor" href="#installing-required-packages"></a>
</h4>
<p>jetty also supports installing required packages at runtime. For example, the following code will fail because the required packages are not installed in the Docker image:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">jetty</span><span class="fu">::</span><span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hp</span>, y <span class="op">=</span> <span class="va">mpg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in loadNamespace(x): there is no package called ‘ggplot2’</span></span></code></pre></div>
<p>However, by setting <code>install_dependencies = TRUE</code> we can tell jetty to discover the required packages and install them before executing the code:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">jetty</span><span class="fu">::</span><span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hp</span>, y <span class="op">=</span> <span class="va">mpg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  install_dependencies <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  stdout <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-1.png" width="80%"></p>
<p><strong>Note</strong>: this feature uses <a href="https://rstudio.github.io/renv/reference/dependencies.html" class="external-link"><code>renv::dependencies</code></a> to discover the required packages, and won’t handle all possible scenarios. In particular, it won’t install specific package versions (just the latest version) and it will only install packages that are on CRAN. Use this with care!</p>
</div>
</div>
<div class="section level3">
<h3 id="error-handling">Error handling<a class="anchor" aria-label="anchor" href="#error-handling"></a>
</h3>
<p>jetty copies errors from the child R process to the main R session:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">jetty</span><span class="fu">::</span><span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fl">1</span> <span class="op">+</span> <span class="st">"A"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in 1 + "A": non-numeric argument to binary operator</span></span></code></pre></div>
<p>Although the errors themselves are propagated to the main R session, the stack trace is (currently) not propagated. This means that calling functions such as <code><a href="https://rdrr.io/r/base/traceback.html" class="external-link">traceback()</a></code> and <code><a href="https://rlang.r-lib.org/reference/last_error.html" class="external-link">rlang::last_trace()</a></code> won’t be of any help.</p>
</div>
<div class="section level3">
<h3 id="standard-output-and-error">Standard output and error<a class="anchor" aria-label="anchor" href="#standard-output-and-error"></a>
</h3>
<p>By default, the standard output and error of the Docker subprocess are printed to the R console. However, since jetty uses <code><a href="https://rdrr.io/r/base/system2.html" class="external-link">system2()</a></code> to execute all Docker commands, you can specify the <code>stdout</code> and <code>stderr</code> arguments which will be passed directly to <code><a href="https://rdrr.io/r/base/system2.html" class="external-link">system2()</a></code>. For example the following code will print a series of messages to the console:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">jetty</span><span class="fu">::</span><span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span><span class="op">{</span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"iter"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span>; <span class="cn">TRUE</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; iter1</span></span>
<span><span class="co">#&gt; iter2</span></span>
<span><span class="co">#&gt; iter3</span></span>
<span><span class="co">#&gt; iter4</span></span>
<span><span class="co">#&gt; iter5</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>But you can discard this output by setting <code>stdout = FALSE</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">jetty</span><span class="fu">::</span><span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span><span class="op">{</span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"iter"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span>; <span class="cn">TRUE</span><span class="op">}</span>, stdout <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>To see more details on controlling <code>stdout</code> and <code>stderr</code>, check out the <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/system2.html" class="external-link">documentation here</a>.</p>
</div>
<div class="section level3">
<h3 id="rprofile-and-renviron">.Rprofile and .Renviron<a class="anchor" aria-label="anchor" href="#rprofile-and-renviron"></a>
</h3>
<p>jetty also provides some support for <code>.Rprofile</code> and <code>.Renviron</code> files. By default, jetty will search for files called “.Rprofile” and “.Renviron” in the current working directory. If these files exist, jetty will port them to the Docker execution environment and will execute any code in <code>.Rprofile</code> and load all environment variables in <code>.Renviron</code> before executing the provided R code. If the <code>.Rprofile</code> file uses external packages, it is essential to tell jetty to install required packages (as described above) otherwise the code will fail.</p>
<p>The user can explicitly provide <code>.Rprofile</code> and <code>.Renviron</code> file paths via the <code>r_profile</code> and <code>r_environ</code> arguments. For example, the following code will attach the <code>.Rprofile</code> found in the <code>/man/scaffolding/</code> sub-directory of the current working directory. This file simply uses the <a href="https://github.com/rladies/praise" class="external-link">praise</a> package to provide some encouragement at the start of a new R session.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">four</span> <span class="op">&lt;-</span> <span class="fu">jetty</span><span class="fu">::</span><span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span></span>
<span>  \<span class="op">(</span><span class="op">)</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">2</span>,</span>
<span>  r_profile <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"man/scaffolding/.Rprofile"</span><span class="op">)</span>,</span>
<span>  install_dependencies <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Installing package into ‘/usr/local/lib/R/site-library’</span></span>
<span><span class="co">#&gt; (as ‘lib’ is unspecified)</span></span>
<span><span class="co">#&gt; trying URL 'https://r-lib.github.io/p/pak/stable/source/linux-gnu/aarch64/src/contrib/../../../../../linux/aarch64/pak_0.8.0_R-4-4_aarch64-linux.tar.gz'</span></span>
<span><span class="co">#&gt; Content type 'application/gzip' length 8847947 bytes (8.4 MB)</span></span>
<span><span class="co">#&gt; ==================================================</span></span>
<span><span class="co">#&gt; downloaded 8.4 MB</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * installing *binary* package ‘pak’ ...</span></span>
<span><span class="co">#&gt; * DONE (pak)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The downloaded source packages are in</span></span>
<span><span class="co">#&gt;  ‘/tmp/RtmpNxnaJk/downloaded_packages’</span></span>
<span><span class="co">#&gt; ✔ Updated metadata database: 3.07 MB in 8 files.</span></span>
<span><span class="co">#&gt; ✔ Updating metadata database ... done</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; → Will install 1 package.</span></span>
<span><span class="co">#&gt; → Will download 1 CRAN package (6.10 kB).</span></span>
<span><span class="co">#&gt; + praise   1.0.0 [bld][dl] (6.10 kB)</span></span>
<span><span class="co">#&gt;   </span></span>
<span><span class="co">#&gt; ℹ Getting 1 pkg (6.10 kB)</span></span>
<span><span class="co">#&gt; ✔ Got praise 1.0.0 (source) (6.10 kB)</span></span>
<span><span class="co">#&gt; ℹ Building praise 1.0.0</span></span>
<span><span class="co">#&gt; ✔ Built praise 1.0.0 (403ms)</span></span>
<span><span class="co">#&gt; ✔ Installed praise 1.0.0  (7ms)</span></span>
<span><span class="co">#&gt; ✔ 1 pkg: added 1, dld 1 (6.10 kB) [3.8s]</span></span>
<span><span class="co">#&gt; You are exquisite!</span></span></code></pre></div>
<p>However, as noted above, this fails if <code>install_dependencies = FALSE</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">four</span> <span class="op">&lt;-</span> <span class="fu">jetty</span><span class="fu">::</span><span class="fu"><a href="reference/run.html">run</a></span><span class="op">(</span></span>
<span>  \<span class="op">(</span><span class="op">)</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">2</span>,</span>
<span>  r_profile <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"man/scaffolding/.Rprofile"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in loadNamespace(x): there is no package called ‘praise’</span></span></code></pre></div>
<div class="section level4">
<h4 id="multiple-rprofile-or-renviron-files">Multiple .Rprofile or .Renviron files<a class="anchor" aria-label="anchor" href="#multiple-rprofile-or-renviron-files"></a>
</h4>
<p>Currently jetty only supports single <code>.Rprofile</code> or <code>.Renviron</code> files. So, for example, if a user has a project-specific .Rprofile in the current working directory at <code>./.Rprofile</code> and then a user-specific .Rprofile at <code>~/.Rprofile</code>, jetty will only source <code>./.Rprofile</code> and will ignore <code>~/.Rprofile</code>. This is a feature I plan to add before long.</p>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=jetty" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/dmolitor/jetty/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/dmolitor/jetty/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing jetty</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Daniel Molitor <br><small class="roles"> Author, copyright holder, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/dmolitor/jetty/actions/workflows/pkgdown.yaml" class="external-link"><img src="https://github.com/dmolitor/jetty/actions/workflows/pkgdown.yaml/badge.svg" alt="pkgdown"></a></li>
<li><a href="https://github.com/dmolitor/jetty/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/dmolitor/jetty/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://CRAN.R-project.org/package=jetty" class="external-link"><img src="https://www.r-pkg.org/badges/version/jetty" alt="CRAN status"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Molitor.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
