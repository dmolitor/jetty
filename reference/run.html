<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Execute an R expression inside a Docker container — run • jetty</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Execute an R expression inside a Docker container — run"><meta name="description" content="This function is somewhat similar in spirit to
callr::r() in that the user can pass
a function (or a code block) to be evaluated. This code will
be executed within the context of a Docker container and the result will be
returned within the local R session."><meta property="og:description" content="This function is somewhat similar in spirit to
callr::r() in that the user can pass
a function (or a code block) to be evaluated. This code will
be executed within the context of a Docker container and the result will be
returned within the local R session."><meta property="og:image" content="https://dmolitor.com/jetty/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">jetty</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dmolitor/jetty/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Execute an R expression inside a Docker container</h1>
      <small class="dont-index">Source: <a href="https://github.com/dmolitor/jetty/blob/main/R/run.R" class="external-link"><code>R/run.R</code></a></small>
      <div class="d-none name"><code>run.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function is somewhat similar in spirit to
<code><a href="https://callr.r-lib.org/reference/r.html" class="external-link">callr::r()</a></code> in that the user can pass
a function (or a code block) to be evaluated. This code will
be executed within the context of a Docker container and the result will be
returned within the local R session.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">run</span><span class="op">(</span></span>
<span>  <span class="va">func</span>,</span>
<span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  image <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"r-base:"</span>, <span class="fu">r_version</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  stdout <span class="op">=</span> <span class="st">""</span>,</span>
<span>  stderr <span class="op">=</span> <span class="st">""</span>,</span>
<span>  install_dependencies <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  r_profile <span class="op">=</span> <span class="fu">jetty_r_profile</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  r_environ <span class="op">=</span> <span class="fu">jetty_r_environ</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-func">func<a class="anchor" aria-label="anchor" href="#arg-func"></a></dt>
<dd><p>Function object or code block to be executed in the R session
within the Docker container. It is best to reference package functions using
the <code>::</code> notation, and only packages installed in the Docker container are
accessible.</p></dd>


<dt id="arg-args">args<a class="anchor" aria-label="anchor" href="#arg-args"></a></dt>
<dd><p>Arguments to pass to the function. Must be a list.</p></dd>


<dt id="arg-image">image<a class="anchor" aria-label="anchor" href="#arg-image"></a></dt>
<dd><p>A string in the <code>image:tag</code> format specifying either a local
Docker image or an image available on DockerHub. Default image is
<code>r-base:{jetty:::r_version()}</code> where your R version is determined from
your local R session.</p></dd>


<dt id="arg-stdout-stderr">stdout, stderr<a class="anchor" aria-label="anchor" href="#arg-stdout-stderr"></a></dt>
<dd><p>where output to ‘stdout’ or ‘stderr’ should be sent.
Possible values are "", to the R console (the default), NULL
(discard output), FALSE (discard output), TRUE
(capture the output silently and then discard), or a
character string naming a file. See <code><a href="https://rdrr.io/r/base/system2.html" class="external-link">system2</a></code> which this
function uses under the hood; however, note that <code><a href="https://rdrr.io/r/base/system2.html" class="external-link">system2</a></code>
handles these options slightly differently.</p></dd>


<dt id="arg-install-dependencies">install_dependencies<a class="anchor" aria-label="anchor" href="#arg-install-dependencies"></a></dt>
<dd><p>A boolean indicating whether jetty should
discover packages used in your code and try to install them in the
Docker container prior to executing the provided function/expression.
In general, things will work better if the Docker image already has all
necessary packages installed.</p></dd>


<dt id="arg-r-profile-r-environ">r_profile, r_environ<a class="anchor" aria-label="anchor" href="#arg-r-profile-r-environ"></a></dt>
<dd><p>Paths specifying where jetty should search for
the .Rprofile and .Renviron files to transfer to the Docker sub-process.
By default jetty will look for files called ".Rprofile" and ".Renviron"
in the current working directory. If either file is found, they will be
transferred to the Docker sub-process and loaded before executing any
R commands. To explicitly exclude either file, set the value to `NULL`.
Alternatively, to exclude either file for all jetty function calls,
set the `JETTY_IGNORE_RPROFILE`/`JETTY_IGNORE_RENVIRON` environment
variable(s) to one of `c(TRUE, "T")` or set the R option(s)
`jetty.ignore.rprofile`/`jetty.ignore.renviron` to `TRUE`.</p></dd>


<dt id="arg-debug">debug<a class="anchor" aria-label="anchor" href="#arg-debug"></a></dt>
<dd><p>A boolean indicating whether to print out the commands that are
being executed via the shell. This is mostly helpful to see what is
happening when things start to error.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Value of the evaluated expression.</p>
    </div>
    <div class="section level2">
    <h2 id="side-effects">Side effects<a class="anchor" aria-label="anchor" href="#side-effects"></a></h2>



<p>It is important to note that some side effects, e.g. plotting,
may be lost since these are being screamed into the void of the Docker
container. However, the user has full control over the 'stdterr' and 'stdout'
of the R sub-process running in the Docker container, and so side effects such
as messages, warnings, and printed output can be directed to the console or
captured by the user.</p>
<p>It is also crucial to note that actions on the local file system will not
work with jetty sub-processes. For example, reading or writing files to/from
the local file system will fail since the R sub-process within the Docker
container does not have access to the local file system.</p>
    </div>
    <div class="section level2">
    <h2 id="error-handling">Error handling<a class="anchor" aria-label="anchor" href="#error-handling"></a></h2>



<p>jetty will propagate errors from the Docker process to the main process.
That is, if an error is thrown in the Docker process, an error with the same
message will be thrown in the main process. However, because of the
somewhat isolated nature of the local process and the Docker process,
calling functions such as <code><a href="https://rdrr.io/r/base/traceback.html" class="external-link">base::traceback()</a></code> and <code><a href="https://rlang.r-lib.org/reference/last_error.html" class="external-link">rlang::last_trace()</a></code> will
not print the callstack of the uncaught error as that has
(in its current form) been lost in the Docker void.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu">run</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">mtcars</span> <span class="op">&lt;-</span> <span class="va">mtcars</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span>cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">model</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A code snippet that requires packages to be installed</span></span></span>
<span class="r-in"><span><span class="fu">run</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">mtcars</span> <span class="op">&lt;-</span> <span class="va">mtcars</span> <span class="op">|&gt;</span> </span></span>
<span class="r-in"><span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">model</span></span></span>
<span class="r-in"><span>  <span class="op">}</span>,</span></span>
<span class="r-in"><span>  install_dependencies <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This will error since the `praise` package is not installed</span></span></span>
<span class="r-in"><span><span class="fu">run</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu">praise</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/praise/man/praise.html" class="external-link">praise</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Explicitly tell jetty to ignore an existing .Rprofile</span></span></span>
<span class="r-in"><span><span class="fu">run</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span>, r_profile <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Molitor.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

